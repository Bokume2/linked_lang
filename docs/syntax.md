# Syntax of Linked Lang (JSON-LD)
## 用語定義
このドキュメントでは以下の用語を使用します。

### ノード
[node_types.md](node_types.md)に規定された型を持ち、プロパティを持つオブジェクトの総称です。[JSON-LD](https://www.w3.org/TR/json-ld/)文書内では *node object* と *value object* 、および最上位マッピングが区別されますが、このドキュメントでは特に区別しません。

### プロパティ
キーと値のペアで表現されるノードの中身で、特にキーが`@type`またはそれにマッピングされるtermでないものです。こちらも、[JSON-LD](https://www.w3.org/TR/json-ld/)文書内ではpropertiesと`@value`エントリーを区別しますが、このドキュメントでは特に区別しません。

### 関数
評価すると値を返すノードです。

### 命令
実行しても値を返さないノードのうち、コードブロックでないものです。

### コードブロック
0個以上の命令の順序付きリストを持つノードです。

## ノード型
ノード型の正式な一覧および詳細説明は[node_types.md](node_types.md)を参照して下さい。  
ノードの階層化に関する規定などもこれに従います。

### IRIの名前空間
Linked Langでは、ノード型名やプロパティ名をIRIとして記述するために、`linkedlang.org`という\(現時点で\)架空のドメインを名前空間に利用します。  
例えば、コードブロックを表現する`Code`型は、正式には`https://linkedlang.org/ns#Code`型です。

## プログラムの構成
Linkd Langでは、プログラムは1つの`Code`型ノードとして記述します。最上位ノードが`Code`型でない場合は何もせず、最上位ノードが2つ以上存在する場合はエラーとなります。  
また、プログラムの実行時には、プログラムそのものである最上位の`Code`型ノードを実行します。[node_types.md](node_types.md)で説明している通り、`Code`を実行するとその内容である命令のリストが順次実行され、各命令がプロパティを評価または実行することでそれぞれの下位ノードが機能します。

## 構文
[node_types.md](node_types.md)の記述に従ったノードのグラフを、JSON-LDで記述します。各ノード型の定義に規定されていないプロパティを記述すると無視されます。  
JSON-LDの構文については[規格文書](https://www.w3.org/TR/json-ld/)を参照して下さい。  

ただし、この実装では、Linked Lang処理系はソースコードを解釈する際に、ソースコードのcontext定義に[`context.jsonld`](../context.jsonld)に記載されたデフォルトcontextを統合したものとして扱います。具体的なアルゴリズムは[後述](#デフォルトcontextの統合)します。  
このデフォルトcontextの統合があるため、ソースコードでは最低限のcontext定義を省略することができ、必ずしも”完全な”JSON-LDドキュメントである必要は無いことに注意して下さい。  

また、この実装では、デフォルトcontextを統合したソースコードに対し、空のマッピングをcontext定義に指定した"Compaction"処理を行ったJSON-LDドキュメントを解釈します。Compaction処理を行った結果正しいノード構造となるものであれば、ソースコードに冗長な記述があっても構いません。  
Compaction処理については[JSON-LD APIの文書](https://www.w3.org/TR/json-ld11-api/#compaction-algorithm)を参照して下さい。

### デフォルトcontextの統合
1. ソースコードの最上位ノードにcontext定義が存在しない場合、デフォルトcontextを新しいcontext定義とする。
1. ソースコードのcontext定義がJSONオブジェクトである場合、デフォルトcontextの内容をそれに統合する。  
   元のマッピングに存在しなかったキーは新しいエントリーとして追加し、既存のキーは値を上書きする。
1. ソースコードのcontext定義が配列である場合、新しい要素としてデフォルトcontextを追加する。
1. ソースコードのcontextが単一のIRIである場合、そのIRIを1番目、デフォルトcontextを2番目の要素とした配列を新しいcontext定義とする。
